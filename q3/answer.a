<q>
/ The start time
\echo "-----------------------------------------"
gtime .z.p
\echo "---------------------------------------"
</q>

CREATE TABLE TLike (user INT, artist INT)
CREATE TABLE TFriends (user1 INT, user2 INT)

LOAD DATA INFILE "like.csv"
  INTO TABLE TLike FIELDS TERMINATED BY ","

LOAD DATA INFILE "friends.csv"
  INTO TABLE TFriends FIELDS TERMINATED BY ","

INSERT INTO TFriends SELECT user2, user1 FROM TFriends

CREATE TABLE UFriends AS
  SELECT user1, user2 FROM DISTINCT(TFriends)

CREATE TABLE ULike AS SELECT * FROM DISTINCT(TLike)

CREATE TABLE t1 AS SELECT user1, user2 as user FROM UFriends

// user1 and user2 who like artist, artist, 1 
CREATE TABLE temp1 AS
  SELECT t1.user1 as user1, t1.user as user2, ULike.artist as artist, 1 as dummy
    FROM t1 INNER JOIN ULike USING user


// user1's friend that likes artist, artist 
CREATE TABLE temp2 AS SELECT DISTINCT user1, artist FROM temp1

CREATE TABLE tempULike AS SELECT user as user1, artist FROM ULike

// user1 that does not like artist but
// friend likes artist, artist
<q>
`temp3 set temp2 except tempULike
</q>

// user1 that does not like artist
// but user1's friend likes artist, artist, 1
CREATE TABLE temp4 AS
  SELECT user1, artist, 1 as dummy FROM temp3


// user1 that does not like artist
// user2 that likes artist 
// and user1's friend, artist
CREATE TABLE result AS
  SELECT user1, user2, artist
    FROM temp1 INNER JOIN temp4 USING (user1, artist)

<q>
/ The ending time
\echo "-----------------------------------"
gtime .z.p
\echo "-----------------------------------"
\echo "result to csv file"
</q>

SELECT * FROM result
INTO OUTFILE "result.csv"
FIELDS TERMINATED BY ","

// Quit option
// <q>\\</q>
